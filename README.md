# CampusTrace

A modern campus issue reporting system for VIT Vellore, built with React, MapLibre, and Supabase.

## Features

- ğŸ—ºï¸ **Interactive Map** - MapLibre-based map with Swiss/Toon styling centered on VIT Vellore
- ğŸ“ **Two-Step Pin Placement** - Click to place, drag to adjust, click pin to confirm
- ğŸ” **Google Authentication** - Secure sign-in with Google OAuth
- ğŸ‘¤ **User-Linked Reports** - All reports tied to authenticated user accounts
- ğŸ›¡ï¸ **Admin Dashboard** - View, manage, and resolve all campus reports
- ğŸ“Š **CSV Export** - Download all reports data for analysis
- ğŸ“± **GPS Location** - Center map on your current location
- ğŸ¨ **Swiss Design** - Clean, minimal UI with high contrast

## Tech Stack

- **Frontend**: React 18, Vite
- **Styling**: Tailwind CSS
- **Map**: MapLibre GL JS, OpenFreeMap tiles
- **Backend**: Supabase (PostgreSQL + Auth)
- **Icons**: Lucide React
- **Routing**: React Router DOM

## Prerequisites

- Node.js 18+ and npm
- Supabase account
- Google Cloud Console account (for OAuth)

## Setup Instructions

### 1. Clone the Repository

```bash
git clone https://github.com/shresthkushwaha/CampusTrace.git
cd CampusTrace
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Configure Environment Variables

Create a `.env` file in the root directory:

```env
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_KEY=your_supabase_anon_key
```

### 4. Set Up Supabase Database

Run the following SQL in your Supabase SQL Editor:

```sql
-- Create reports table
CREATE TABLE reports (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  lat float8 not null,
  lng float8 not null,
  category text not null,
  description text,
  status text default 'open',
  user_ip text,
  user_id uuid references auth.users(id)
);

-- Enable Row Level Security
ALTER TABLE reports ENABLE ROW LEVEL SECURITY;

-- Users can view their own reports
CREATE POLICY "Users can view own reports"
ON reports FOR SELECT
TO authenticated
USING (auth.uid() = user_id);

-- Users can insert their own reports
CREATE POLICY "Users can insert own reports"
ON reports FOR INSERT
TO authenticated
WITH CHECK (auth.uid() = user_id);

-- Users can update their own reports
CREATE POLICY "Users can update own reports"
ON reports FOR UPDATE
TO authenticated
USING (auth.uid() = user_id);
```

### 5. Configure Google OAuth

Follow the detailed instructions in [GOOGLE_AUTH_SETUP.md](./GOOGLE_AUTH_SETUP.md) to:
1. Enable Google OAuth in Supabase
2. Create OAuth credentials in Google Cloud Console
3. Configure the credentials in Supabase

### 6. Configure Admin Access

Edit `src/config/admins.js` to add admin email addresses:

```javascript
const ADMIN_EMAILS = [
  'your-admin-email@gmail.com',
  // Add more admin emails here
];
```

### 7. Run Development Server

```bash
npm run dev
```

Visit `http://localhost:5173` to see the app!

## Usage

### For Users

1. **Sign In** - Click "Continue with Google" to authenticate
2. **Report an Issue** - Click on the map to place a pin, drag to adjust position
3. **Submit Report** - Click the pin, select category, add description, and submit
4. **Sign Out** - Click the sign-out icon in the top-left corner

### For Admins

1. **Access Dashboard** - Click the blue shield icon (visible only to admins)
2. **View Reports** - See all submitted reports in the left panel
3. **Zoom to Report** - Click any report to zoom the map to its location
4. **Resolve Reports** - Click "Mark as Resolved" on open reports
5. **Export Data** - Click "Download CSV" to export all reports

## Project Structure

```
campus-trace/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Map.jsx              # Main map component
â”‚   â”‚   â”œâ”€â”€ ReportModal.jsx      # Report submission modal
â”‚   â”‚   â”œâ”€â”€ ProtectedRoute.jsx   # Auth route guard
â”‚   â”‚   â””â”€â”€ AdminRoute.jsx       # Admin route guard
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Home.jsx             # Home page with map
â”‚   â”‚   â”œâ”€â”€ Login.jsx            # Login page
â”‚   â”‚   â””â”€â”€ Admin.jsx            # Admin dashboard
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ admins.js            # Admin email configuration
â”‚   â”œâ”€â”€ AuthContext.jsx          # Authentication context
â”‚   â”œâ”€â”€ supabaseClient.js        # Supabase client setup
â”‚   â”œâ”€â”€ App.jsx                  # Main app component
â”‚   â””â”€â”€ index.css                # Global styles
â”œâ”€â”€ .env                         # Environment variables (not committed)
â”œâ”€â”€ .gitignore                   # Git ignore rules
â””â”€â”€ package.json                 # Dependencies
```

## Deployment

### Build for Production

```bash
npm run build
```

The production-ready files will be in the `dist/` directory.

### Deploy to Vercel/Netlify

1. Connect your GitHub repository
2. Set environment variables (`VITE_SUPABASE_URL`, `VITE_SUPABASE_KEY`)
3. Deploy!

## Security Notes

- âš ï¸ **Never commit `.env` file** - It contains sensitive credentials
- âœ… Row Level Security (RLS) is enabled on the database
- âœ… Reports are linked to authenticated users
- âœ… Admin access is controlled via email whitelist

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

MIT License - feel free to use this project for your campus!

## Support

For issues or questions, please open an issue on GitHub.

---

Built with â¤ï¸ for VIT Vellore
